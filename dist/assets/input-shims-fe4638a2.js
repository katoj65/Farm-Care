import{K as k,L as C,M,G as p,E as F,N as H,O as y,P as G,Q as U,R as Y}from"./index-e01af828.js";/*!
 * (C) Ionic http://ionicframework.com - MIT License
 */const A=new WeakMap,D=(e,s,t,o=0,n=!1)=>{A.has(e)!==t&&(t?q(e,s,o,n):W(e,s))},$=e=>e===e.getRootNode().activeElement,q=(e,s,t,o=!1)=>{const n=s.parentNode,i=s.cloneNode(!1);i.classList.add("cloned-input"),i.tabIndex=-1,o&&(i.disabled=!0),n.appendChild(i),A.set(e,i);const a=e.ownerDocument.dir==="rtl"?9999:-9999;e.style.pointerEvents="none",s.style.transform="translate3d(".concat(a,"px,").concat(t,"px,0) scale(0)")},W=(e,s)=>{const t=A.get(e);t&&(A.delete(e),t.remove()),e.style.pointerEvents="",s.style.transform=""},_=50,z=(e,s,t)=>{if(!t||!s)return()=>{};const o=a=>{$(s)&&D(e,s,a)},n=()=>D(e,s,!1),i=()=>o(!0),c=()=>o(!1);return C(t,"ionScrollStart",i),C(t,"ionScrollEnd",c),s.addEventListener("blur",n),()=>{M(t,"ionScrollStart",i),M(t,"ionScrollEnd",c),s.removeEventListener("blur",n)}},I="input, textarea, [no-blur], [contenteditable]",j=()=>{let e=!0,s=!1;const t=document,o=()=>{s=!0},n=()=>{e=!0},i=c=>{if(s){s=!1;return}const a=t.activeElement;if(!a||a.matches(I))return;const f=c.target;f!==a&&(f.matches(I)||f.closest(I)||(e=!1,setTimeout(()=>{e||a.blur()},50)))};return C(t,"ionScrollStart",o),t.addEventListener("focusin",n,!0),t.addEventListener("touchend",i,!1),()=>{M(t,"ionScrollStart",o,!0),t.removeEventListener("focusin",n,!0),t.removeEventListener("touchend",i,!1)}},Q=.3,J=(e,s,t,o)=>{var n;const i=(n=e.closest("ion-item,[ion-item]"))!==null&&n!==void 0?n:e;return V(i.getBoundingClientRect(),s.getBoundingClientRect(),t,o)},V=(e,s,t,o)=>{const n=e.top,i=e.bottom,c=s.top,a=Math.min(s.bottom,o-t),f=c+15,v=a-_-i,d=f-n,l=Math.round(v<0?-v:d>0?-d:0),S=Math.min(l,n-c),T=Math.abs(S)/Q,r=Math.min(400,Math.max(150,T));return{scrollAmount:S,scrollDuration:r,scrollPadding:t,inputSafeY:-(n-f)+4}},x="$ionPaddingTimer",B=(e,s,t)=>{const o=e[x];o&&clearTimeout(o),s>0?e.style.setProperty("--keyboard-offset","".concat(s,"px")):e[x]=setTimeout(()=>{e.style.setProperty("--keyboard-offset","0px"),t&&t()},120)},N=(e,s,t)=>{const o=()=>{s&&B(s,0,t)};e.addEventListener("focusout",o,{once:!0})};let g=0;const K="data-ionic-skip-scroll-assist",X=(e,s,t,o,n,i,c,a=!1)=>{const f=i&&(c===void 0||c.mode===H.None);let u=!1;const v=y!==void 0?y.innerHeight:0,d=L=>{if(u===!1){u=!0;return}O(e,s,t,o,L.detail.keyboardHeight,f,a,v,!1)},l=()=>{u=!1,y===null||y===void 0||y.removeEventListener("ionKeyboardDidShow",d),e.removeEventListener("focusout",l,!0)},S=async()=>{if(s.hasAttribute(K)){s.removeAttribute(K);return}O(e,s,t,o,n,f,a,v),y===null||y===void 0||y.addEventListener("ionKeyboardDidShow",d),e.addEventListener("focusout",l,!0)};return e.addEventListener("focusin",S,!0),()=>{e.removeEventListener("focusin",S,!0),y===null||y===void 0||y.removeEventListener("ionKeyboardDidShow",d),e.removeEventListener("focusout",l,!0)}},P=e=>{document.activeElement!==e&&(e.setAttribute(K,"true"),e.focus())},O=async(e,s,t,o,n,i,c=!1,a=0,f=!0)=>{if(!t&&!o)return;const u=J(e,t||o,n,a);if(t&&Math.abs(u.scrollAmount)<4){P(s),i&&t!==null&&(B(t,g),N(s,t,()=>g=0));return}if(D(e,s,!0,u.inputSafeY,c),P(s),G(()=>e.click()),i&&t&&(g=u.scrollPadding,B(t,g)),typeof window<"u"){let v;const d=async()=>{v!==void 0&&clearTimeout(v),window.removeEventListener("ionKeyboardDidShow",l),window.removeEventListener("ionKeyboardDidShow",d),t&&await Y(t,0,u.scrollAmount,u.scrollDuration),D(e,s,!1,u.inputSafeY),P(s),i&&N(s,t,()=>g=0)},l=()=>{window.removeEventListener("ionKeyboardDidShow",l),window.addEventListener("ionKeyboardDidShow",d)};if(t){const S=await U(t),L=S.scrollHeight-S.clientHeight;if(f&&u.scrollAmount>L-S.scrollTop){s.type==="password"?(u.scrollAmount+=_,window.addEventListener("ionKeyboardDidShow",l)):window.addEventListener("ionKeyboardDidShow",d),v=setTimeout(d,1e3);return}}d()}},Z=!0,te=async(e,s)=>{const t=document,o=s==="ios",n=s==="android",i=e.getNumber("keyboardHeight",290),c=e.getBoolean("scrollAssist",!0),a=e.getBoolean("hideCaretOnScroll",o),f=e.getBoolean("inputBlurring",o),u=e.getBoolean("scrollPadding",!0),v=Array.from(t.querySelectorAll("ion-input, ion-textarea")),d=new WeakMap,l=new WeakMap,S=await k.getResizeMode(),L=async r=>{await new Promise(b=>p(r,b));const h=r.shadowRoot||r,w=h.querySelector("input")||h.querySelector("textarea"),m=F(r),R=m?null:r.closest("ion-footer");if(!w)return;if(m&&a&&!d.has(r)){const b=z(r,w,m);d.set(r,b)}if(!(w.type==="date"||w.type==="datetime-local")&&(m||R)&&c&&!l.has(r)){const b=X(r,w,m,R,i,u,S,n);l.set(r,b)}},T=r=>{if(a){const h=d.get(r);h&&h(),d.delete(r)}if(c){const h=l.get(r);h&&h(),l.delete(r)}};f&&Z&&j();for(const r of v)L(r);t.addEventListener("ionInputDidLoad",r=>{L(r.detail)}),t.addEventListener("ionInputDidUnload",r=>{T(r.detail)})};export{te as startInputShims};
